# Author: Ali Uneri
# Date: 2014-01-23

set(EP_OPTION_NAME "USE_${EP_NAME}")
set(EP_REQUIRED_PROJECTS Slicer)
set(EP_URL "git://github.com/SlicerIGT/SlicerIGT.git")

cma_envvar(SLICERPATH APPEND "@BINARY_DIR@/lib/Slicer-${${PROJECT_NAME}_Slicer_VERSION}/qt-loadable-modules/@INTDIR@")
cma_envvar(SLICERPATH APPEND "@BINARY_DIR@/lib/Slicer-${${PROJECT_NAME}_Slicer_VERSION}/qt-scripted-modules")

cma_end_definition()
# -----------------------------------------------------------------------------

if(${PROJECT_NAME}_Slicer_VERSION VERSION_EQUAL "4.4")
  set(EP_VERSION "fbe53d843edc085e81ece133f1ebaa9539b1119e")
elseif(${PROJECT_NAME}_Slicer_VERSION VERSION_EQUAL "4.5")
  set(EP_VERSION "24b08c44cc47c651addab6e60c598f0c75a2d91a")
else()
  message(FATAL_ERROR "Slicer version ${${PROJECT_NAME}_Slicer_VERSION} is not supported")
endif()

set(EP_CMAKE_ARGS
  -DADDITIONAL_C_FLAGS:STRING=${CMAKE_C_FLAGS}
  -DADDITIONAL_CXX_FLAGS:STRING=${CMAKE_CXX_FLAGS}
  -DBUILD_TESTING:BOOL=OFF
  -DCMAKE_BUILD_TYPE:STRING=${CMAKE_BUILD_TYPE}
  -DGIT_EXECUTABLE:FILEPATH=${${PROJECT_NAME}_GIT_EXECUTABLE}
  -DPYTHON_EXECUTABLE:FILEPATH=${${PROJECT_NAME}_PYTHON_EXECUTABLE}
  -DPYTHON_INCLUDE_DIR:PATH=${${PROJECT_NAME}_PYTHON_INCLUDE_DIR}
  -DPYTHON_LIBRARY:FILEPATH=${${PROJECT_NAME}_PYTHON_LIBRARY}
  -DSlicer_DIR:PATH=${${PROJECT_NAME}_Slicer_DIR})

list(APPEND EP_CMAKE_ARGS
  -DSLICERIGT_REPOSITORY_TAG_BreachWarning:STRING=cf2fa5b79aa4ad9f1807e20c3c4a8ae6ff020b26
  -DSLICERIGT_REPOSITORY_TAG_CollectFiducials:STRING=8ea696c717bfecc42d0387269a7631969ab2f557
  -DSLICERIGT_REPOSITORY_TAG_CreateModels:STRING=69a082223187c951fd9503e7735269c7c7fd8d6d
  -DSLICERIGT_REPOSITORY_TAG_FiducialRegistrationWizard:STRING=650d9f1bcbb158a19104c64eaf14a696660258fd
  -DSLICERIGT_REPOSITORY_TAG_OpenIGTLinkRemote:STRING=7e4dabb6588016319c5fb96fa8d165064c0a1947
  -DSLICERIGT_REPOSITORY_TAG_PathExplorer:STRING=a36ab451e9086d2814bdb4b325f44ed4fd438bd8
  -DSLICERIGT_REPOSITORY_TAG_PivotCalibration:STRING=bfcf08a3ca6278ad90d1805a5325e2c985e99d55
  -DSLICERIGT_REPOSITORY_TAG_PlusRemote:STRING=8c533c9eeae0982b8f142b1c0347ba321d28fc12
  -DSLICERIGT_REPOSITORY_TAG_TransformFusion:STRING=7faae84ef105fde8c72d83573b9846acee4c8aa7
  -DSLICERIGT_REPOSITORY_TAG_UltrasoundSnapshots:STRING=64ed0c477114612c1b20d402f7220f99e272cb6e
  -DSLICERIGT_REPOSITORY_TAG_VolumeResliceDriver:STRING=69769c8c3707ad7922b38d82035a8324134d8a04)

ExternalProject_Add(${EP_NAME}
  DEPENDS ${EP_REQUIRED_PROJECTS}
  # download
  GIT_REPOSITORY ${EP_URL}
  GIT_TAG ${EP_VERSION}
  # patch
  # update
  UPDATE_COMMAND ""
  # configure
  SOURCE_DIR ${PROJECT_BINARY_DIR}/${EP_NAME}
  CMAKE_ARGS ${EP_CMAKE_ARGS}
  # build
  BINARY_DIR ${PROJECT_BINARY_DIR}/${EP_NAME}-build
  # install
  INSTALL_COMMAND ""
  # test
  )
